app-id: com.github.hkdb.Aerion
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
command: aerion

finish-args:
  # Network access for email sync
  - --share=network
  # IPC is required for X11 and Wayland
  - --share=ipc
  # Display access
  - --socket=wayland
  - --socket=fallback-x11
  # GPU access for hardware acceleration
  - --device=dri
  # Notifications
  - --talk-name=org.freedesktop.Notifications
  # Secret Service for secure credential storage
  - --talk-name=org.freedesktop.secrets
  # Sleep/wake detection for sync management
  - --system-talk-name=org.freedesktop.login1
  # Access to Downloads for saving attachments
  - --filesystem=xdg-download
  # Access to Documents for opening attachments
  - --filesystem=xdg-documents

modules:
  - name: aerion
    buildsystem: simple
    build-commands:
      # Extract pre-built binary from tarball
      - tar xzf aerion.tar.gz
      - install -Dm755 aerion /app/bin/aerion

      # Install desktop file (from Flathub repo)
      - install -Dm644 com.github.hkdb.Aerion.desktop /app/share/applications/com.github.hkdb.Aerion.desktop
      - desktop-file-edit --set-key=Icon --set-value=com.github.hkdb.Aerion /app/share/applications/com.github.hkdb.Aerion.desktop
      - desktop-file-edit --set-key=Exec --set-value=aerion /app/share/applications/com.github.hkdb.Aerion.desktop

      # Install icon (from Flathub repo)
      - install -Dm644 com.github.hkdb.Aerion.png /app/share/icons/hicolor/256x256/apps/com.github.hkdb.Aerion.png

      # Install metainfo (from Flathub repo)
      - install -Dm644 com.github.hkdb.Aerion.metainfo.xml /app/share/metainfo/com.github.hkdb.Aerion.metainfo.xml

    sources:
      # Pre-built binary tarball with OAuth credentials (x86_64)
      # UPDATE: version, URL, sha256, and size for each release
      - type: extra-data
        filename: aerion.tar.gz
        only-arches:
          - x86_64
        url: https://github.com/hkdb/aerion/releases/download/v0.1.14/aerion-v0.1.14-linux-x86_64.tar.gz
        sha256: 522042b0a70c3f3ac37844fc383a386db54767ff45a586e6628821d84d934782
        size: 13330634

      # Pre-built binary tarball with OAuth credentials (aarch64)
      - type: extra-data
        filename: aerion.tar.gz
        only-arches:
          - aarch64
        url: https://github.com/hkdb/aerion/releases/download/v0.1.14/aerion-v0.1.14-linux-aarch64.tar.gz
        sha256: 86b08e5dac17481af153fc38e45a653faf29656e7cd0eae4d96a89a9850e1c4a
        size: 12783074
