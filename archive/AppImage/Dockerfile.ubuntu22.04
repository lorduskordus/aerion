FROM ubuntu:jammy-20260109

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install build dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    git \
    pkg-config \
    libgtk-3-dev \
    libwebkit2gtk-4.1-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev \
    patchelf \
    desktop-file-utils \
    libgdk-pixbuf2.0-dev \
    file \
    fuse \
    && rm -rf /var/lib/apt/lists/*

# Install Go 1.23
RUN curl -L https://go.dev/dl/go1.23.4.linux-amd64.tar.gz | tar -C /usr/local -xzf -
ENV PATH="/usr/local/go/bin:${PATH}"

# Install Node.js 20
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
    apt-get install -y nodejs && \
    rm -rf /var/lib/apt/lists/*

# Install Wails CLI
RUN go install github.com/wailsapp/wails/v2/cmd/wails@latest
ENV PATH="/root/go/bin:${PATH}"

# Set working directory
WORKDIR /build

# Allow AppImages to run in Docker without FUSE
ENV APPIMAGE_EXTRACT_AND_RUN=1

# Build script
CMD ["bash", "-c", "make appimage && cp build/bin/Aerion-*.AppImage /output/"]
